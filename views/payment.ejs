<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment - <%= teamName %></title>

  <link rel="stylesheet" href="/payment.css" />

  <style>
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    .status {
      margin-top: 12px;
      font-size: 14px;
      font-weight: 500;
    }
    .success {
      color: green;
    }
    .error {
      color: red;
    }
    .upi-help {
      background: #f0f7ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .upi-help h4 {
      margin: 0 0 10px 0;
      color: #0066cc;
      font-size: 14px;
    }
    .upi-help p {
      margin: 5px 0;
      font-size: 13px;
      color: #333;
    }
    .upi-help .example {
      background: white;
      padding: 8px;
      border-radius: 4px;
      margin-top: 8px;
      font-family: monospace;
      color: #d63384;
      font-weight: 600;
    }
    .upi-help-image {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Hackathon Payment</h2>

    <!-- TEAM INFO -->
    <div class="info-section">
      <div class="info-row">
        <span class="info-label">Team Name:</span>
        <span class="info-value"><%= teamName %></span>
      </div>

      <div class="info-row">
        <span class="info-label">Team Code:</span>
        <span class="info-value"><%= teamcode %></span>
      </div>

      <div class="info-row">
        <span class="info-label">Team Lead:</span>
        <span class="info-value"><%= leadName %></span>
      </div>

      <div class="info-row">
        <span class="info-label">Amount:</span>
        <span class="info-value amount">‚Çπ<%= amount %></span>
      </div>
    </div>

    <!-- QR -->
    <div class="qr-section">
      <p>Scan QR Code to Pay</p>
     <div class="qr-code">
  <% let qrImage = "/qr.png"; %>

  <% if (amount == 3200) { %>
    <% qrImage = "/qr_3200.png"; %>
  <% } else if (amount == 4000) { %>
    <% qrImage = "/qr_4000.png"; %>
  <% } else if (amount == 4800) { %>
    <% qrImage = "/qr_4800.png"; %>
  <% } %>

  <img src="<%= qrImage %>" alt="Payment QR Code" />
</div>

    </div>

   
    <div class="upi-help">
      <h4>üì± Where to find your UPI Reference Number / UTR?</h4>
      <p>After completing the payment, you'll receive a confirmation with a <strong>UPI Reference Number (UTR)</strong>.</p>
      <p><strong>Example formats:</strong></p>
      <div class="example">402356789012 or 240235678901</div>
      
   
      
      <p style="margin-top: 10px;">üí° You can find it in:</p>
      <p>‚Ä¢ Your UPI app's transaction history</p>
      <p>‚Ä¢ SMS confirmation from your bank</p>
      <p>‚Ä¢ Payment success screen</p>
    </div>

  
    <form method="POST" action="/payment/submit" id="paymentForm">
      <input type="hidden" name="teamcode" value="<%= teamcode %>" />
      <input type="hidden" name="teamName" value="<%= teamName %>" />

      <div class="form-group">
        <label for="transactionId">UPI Reference Number / UTR *</label>
        <input
          type="text"
          id="transactionId"
          name="transactionId"
          placeholder="e.g., 402356789012 or 240235678901"
          required
        />
      </div>

      <button type="submit" id="submitBtn">
        Submit Payment Proof
      </button>
    </form>

    <p class="note">Please ensure you've completed the payment before submitting</p>
    <p id="statusMsg" class="status"></p>
  </div>

  <script>
    const form = document.getElementById("paymentForm");
    const btn = document.getElementById("submitBtn");
    const statusMsg = document.getElementById("statusMsg");

    form.addEventListener("submit", () => {
      const transactionId = document.getElementById("transactionId").value;

      btn.disabled = true;
      btn.innerText = "Verifying & Sending Email...";
      form.classList.add("loading");

      statusMsg.innerText = "Please wait, confirming payment...";
      statusMsg.className = "status";

      fetch("/admin/verify", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          teamcode: "<%= teamcode %>",
          transactionId
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          statusMsg.innerText = "‚úÖ Payment submitted & confirmation email sent!";
          
        } else {
          throw new Error();
        }
      })
      .catch(() => {
        statusMsg.innerText =
          "‚ö†Ô∏è Payment submitted, but email failed. Admin will verify manually.";
        statusMsg.classList.add("error");
        btn.disabled = false;
        btn.innerText = "Submit Payment Proof";
        form.classList.remove("loading");
      });
      
    });
  </script>
</body>
</html>